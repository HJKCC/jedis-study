# 概述
全称：Remote Dictionary Server（远程字典服务器）。是用C语言编写的，遵守BCD协议。是一个高性能的(key/value)分布式内存数据库，基于内存运行并支持持久化的NoSQL数据库。

# 简单动态字符串sdshdr
1. 定义：即simple dynamic string（SDS），用作Redis的默认字符串表示。 
2. 属性
<br>a、len：SDS所保存字符串的长度，即buf数组已使用字节数量
<br>b、free：buf数组中未使用字节数量
<br>c、buf[]：用于保存字符串
3. 空间分配策略
<br>a、空间预分配：len < 1MB 时，分配同样大小未使用空间；len >= 1MB 时，分配1MB的未使用空间。
<br>b、惰性空间释放：通过free记录未使用字节数量。
4. 应用场景：Redis的默认字符串。

# 链表list
1. 定义：提供高效的节点重排能力，以及顺序性的节点访问方式，可以通过增删节点来灵活的调整链表的长度。Redis链表实现为双端链表。
2. 属性 
<br>a、head：表头节点指针
<br>b、tail：表尾节点指针
<br>c、len：链表长度
3. 应用场景：链表键、发布与订阅和监视器等。

# 字典dict
1. 定义：又称符号表（symbol table）、关联数组（association array）或映射（map），使用哈希表作为底层实现，是一种用于保存键值对的数据数据结构。字典中每个键都是独一无二的。 
<br>a、哈希表节点：dictEntry结构，每个dictEntry都保存着一个键值对(key/value)，还有一个指向下一个哈希表节点的next指针。
<br>b、哈希表：dictht结构，包含哈希表数组table、哈希表大小size、已有节点数used和用于计算索引的大小掩码sizemask（== size-1）。
2. 属性 
<br>a、ht[2]：哈希表。一般情况下，字典使用ht[0]存储哈希表节点；rehash时，将ht[0]中键值对移入ht[1]，再将释放ht[0]、将ht[1]设置为ht[0]、为ht[1]分配空白哈希表用于下一次rehash。
<br>b、trehashidx：记录rehash的进度，一般为-1。当rehash时，rehash置为0，然后逐渐增1
3. 负载因子：load_factor = used / size；当load_factor > 1时拓展哈希表，当load_factor < 0.1时收缩哈希表。
4. 键冲突：链地址法。冲突节点添加到链表的表头位置。
4. 应用场景：Redis数据库底层实现。

# 跳跃表zskiplist
1. 定义：一种有序数据结构。它通过在每个节点中维持多个指向其他节点的指针，从而可快速访问节点。
2. 属性：
<br>zskiplist：用于保存跳跃表信息。包括表头节点、表尾节点和长度。
<br>zskiplistNode：用于保存跳跃表节点。
<br>成员：
3. 应用场景：有序集合键的底层实现。

# 整数集合intset
1. 定义：Redis用于保存整数值的集合抽象数据结构。整数集合的各个元素按从小到大存于contents数组，且不包含任何重复项。
2. 属性
<br>a、encoding：编码方式，有int16_t、int32_t和int64_t三种。
<br>b、length：元素数量。
<br>c、contents[]：保存元素的数组。以有序、不重复的方式保存集合元素。
3. 自动升级：整型集合可以通过自动升级底层数组来适应新元素。整型集合不支持降级操作。
4. 应用场景：集合键的底层实现。

# 压缩列表ziplist
1. 定义：由一系列特殊编码的连续内存块组成的顺序型数据结构，可以包含任意多个节点（entry），每个节点可以保存一个字节数组（即字符串）或一个整数值。
2. 节点属性
<br>a、previous_entry_length：以字节为单位，记录了压缩列表中前一个节点的长度，1字节或5字节。
<br>b、encoding：记录了content属性所保存数据的类型及长度。
<br>c、content：节点数据。
3. 应用场景：列表键和哈希键的底层实现。

# 对象
1. 定义
<br>a、Redis对象系统包括字符串对象string、列表对象list、哈希对象hash、集合对象set和有序集合对象zset共五种对象，每种对象底层实现至少采用一种Redis数据结构。
<br>b、Redis的数据库中新建一个键值对时，至少创建两个对象：键对象（用作键值对的键）、值对象（用作键值对的值）。
2. redisObject属性
<br>a、type：对象类型，Redis五种对象之一。
<br>b、encoding：编码。
<br>c、ptr：指向对象的底层实现数据结构。
3. 内存回收：引用计数（reference counting）计数。当一个对象不再被使用，即引用计数为0时，该对象所占用的内存就会被自动释放。
4. 对象的空转时长：redisObject的lru属性记录了对象最后一次被命令程序访问的时间。

# 数据库
1. Redis服务器将所有数据库都保存在服务器状态redisServer结构的redisDb结构数组中，每个redisDb结构代表一个数据库。
2. 初始化Redis服务器时，程序会根据服务器状态的dbnum属性来决定应该创建多少个数据库，dbnum默认值为16，即默认会创建16个数据库。
3. 每个数据库的数据是隔离的不能共享，并且基于单机才有，如果是集群就没有数据库的概念。
4. 每个Redis客户端都有自己的目标数据库，默认为0号数据库。可用 SELECT num 命令来切换目标数据库。
5. 键空间：redisDb结构中的dict字典保存了数据库中的所有键值对，该字典被称为键空间（key space）。
<br>a、键空间的键：即数据库的键，每个键都是一个字符串对象。
<br>b、键空间的值：即数据库的值，每个值可以是Redis的五种对象之一。
6. 过期字典：redisDb结构中的expires字典保存了数据库中的所有键的过期时间。
<br>a、过期字典的键：指向键空间中某个键对象的指针。
<br>b、过期字典的值：为long类型的整数。保存了键所指数据库键的过期时间--毫秒精度的UNIX时间戳。
7. 过期键删除策略
<br>定时删除：设置过期时间时，创建一个定时器，过期就立刻删除。费CPU，但能及时释放内存
<br>惰性删除：获取键时，如过期再删除。费内存，但不会在删除其他过期键上花费CPU时间
<br>定期删除：每隔一段时间，程序对数据库进行一次检查，统一删除。需要调优删除操作执行的时长和频率。

# 客户端
1. Redis服务器是典型的一对多服务器程序，可与多个客户端建立网络连接。
2. Redis服务器状态redisServer结构的redisClient结构链表中，保存了所有与服务器连接的客户端的状态结构。
3. redis客户端信息：可通过命令行  redis>CLIENT list 查询。
<br>a、name：名字。默认情况下，客户端是没有名字的。
<br>b、flags：标志。记录了客户端的角色，以及客户端目前所处的状态。
<br>c、qbuf：输入缓冲区，为sds字符串。其长度会根据输入内容动态的缩小或扩大，但最大大小不能超过1GB，否则服务器将关闭此客户端。
<br>d、argv：命令及命令参数，为字符串数组。
<br>e、buf：输出缓冲区之固定大小缓冲区，为sds字符串。默认大小为16KB。用于保存长度比较小的回复，如OK、错误回复等。
<br>f、reply：输出缓冲区之可变大小缓冲区。如果客户端使用output buffer内存大小超过hard limit值，redis会立即关闭此客户端；使用buffer内存大小超过soft limit值，并且持续soft limit秒数，redis也会立即关闭此客户端。

# 服务端
1. 服务端处理请求流程：
<br>a、客户端封装请求命令，并发送给服务端；
<br>b、服务端读取命令请求，并分析出命令及命令参数；
<br>c、命令执行器根据参数查找命令的实现函数，然后执行实现函数并得出命令回复；
<br>d、服务器将命令回复返回给客户端。